@base <https://example.org/indices/> .
@prefix idx: <https://w3id.org/solid-crdt-sync/vocab/idx#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix schema: <https://schema.org/> .
@prefix : <#> .

# Hierarchical grouping template
# Indexes: Note
# Groups by: schema:dateCreated hierarchically (year / month)

:it a idx:GroupIndexTemplate ;
    idx:indexesClass schema:Note ;
    idx:shardingAlgorithm [
        a idx:ModuloHashSharding ;
        idx:hashAlgorithm "md5" ;
        idx:numberOfShards 1 ;
        idx:configVersion "1_0_0" ;
        idx:autoScaleThreshold 1000
    ] ;
    idx:groupedBy [
        a idx:GroupingRule ;
        idx:property [
            a idx:GroupingRuleProperty ;
            idx:sourceProperty schema:dateCreated ;
            idx:hierarchyLevel 1 ;
            idx:transform (
                [
                    a idx:RegexTransform ;
                    idx:pattern "^([0-9]{4})-[0-9]{2}-[0-9]{2}$" ;
                    idx:replacement "${1}"
                ]
            )
        ] , [
            a idx:GroupingRuleProperty ;
            idx:sourceProperty schema:dateCreated ;
            idx:hierarchyLevel 2 ;
            idx:transform (
                [
                    a idx:RegexTransform ;
                    idx:pattern "^[0-9]{4}-([0-9]{2})-[0-9]{2}$" ;
                    idx:replacement "${1}"
                ]
            )
        ]
    ] ;
    idx:readBy <https://example.org/installations/test-456> .
