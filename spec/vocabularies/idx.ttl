@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix idx: <https://w3id.org/solid-crdt-sync/vocab/idx#> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .

# --- Ontology Definition ---

<https://w3id.org/solid-crdt-sync/vocab/idx> a owl:Ontology;
    rdfs:label "Indexing Vocabulary for CRDT Sync";
    rdfs:comment "A vocabulary to describe the structure, configuration, and conventions of indices used for performance and discovery in a offline-first, CRDT-based synchronization system." .

# --- Class Definitions ---

idx:Index a rdfs:Class;
    rdfs:label "Index";
    rdfs:comment "An abstract base class for any sharded index that directly contains entries pointing to data resources." .

idx:FullIndex a rdfs:Class;
    rdfs:label "Full Index";
    rdfs:comment "A concrete index for a FullSync or OnDemandSync strategy. It represents a single, self-contained index for a whole class of data.";
    rdfs:subClassOf idx:Index ;
    rdfs:subClassOf foaf:Document .

idx:GroupIndexTemplate a rdfs:Class;
    rdfs:label "Group Index Template";
    rdfs:comment "A 'rulebook' resource that defines how a data type is grouped. It does not contain data entries itself, but points to the GroupIndex instances that do." ;
    rdfs:subClassOf foaf:Document .

idx:GroupIndex a rdfs:Class;
    rdfs:label "Group Index";
    rdfs:comment "A concrete index representing a single, logical subset of data (e.g., 'August 2025'). It functions like a FullIndex but for a group.";
    rdfs:subClassOf idx:Index ;
    rdfs:subClassOf foaf:Document .

idx:GroupingRule a rdfs:Class;
    rdfs:label "Grouping Rule";
    rdfs:comment "A declarative rule that describes how a data resource should be assigned to a specific group based on its properties. Contains multiple GroupingRuleProperty instances. Group paths are generated deterministically from the properties." .

idx:GroupingRuleProperty a rdfs:Class;
    rdfs:label "Grouping Rule Property";
    rdfs:comment "An individual property specification within a GroupingRule that defines how to extract and format values from a source property for group assignment." .

idx:ModuloHashSharding a rdfs:Class;
    rdfs:label "Modulo Hash Sharding";
    rdfs:comment "A sharding strategy that calculates a hash of a resource's IRI and then uses the modulo operator to assign it to a shard." .

idx:Shard a rdfs:Class;
    rdfs:label "Shard";
    rdfs:comment "A document that contains a list of entries, each pointing to a data resource and its associated metadata (e.g., Hybrid Logical Clock hash)." ;
    rdfs:subClassOf foaf:Document .

idx:ShardEntry a rdfs:Class;
    rdfs:label "Shard Entry";
    rdfs:comment "A structured entry within a shard that contains a reference to a data resource plus optional header properties and required clock hash metadata." .

idx:IndexedProperty a rdfs:Class;
    rdfs:label "Indexed Property";
    rdfs:comment "A configuration object that specifies which property should be indexed and tracks which installations actively read from it. Used within idx:indexedProperty to enable property-level reader management." .

idx:RegexTransform a rdfs:Class;
    rdfs:label "Regex Transform";
    rdfs:comment "A transform rule that applies regex pattern matching and replacement to RDF literal values for group key generation. Uses cross-platform compatible regex subset." .

# --- Property Definitions ---

idx:belongsToIndexShard a rdf:Property;
    rdfs:label "belongs to index shard";
    rdfs:comment "Links a data resource to the specific index shard it is a member of.";
    rdfs:domain rdfs:Resource; # Any resource can belong to an index
    rdfs:range rdfs:Resource . # The value is the IRI of the shard

idx:indexesClass a rdf:Property;
    rdfs:label "indexes class";
    rdfs:comment "Specifies which class of resource this index tracks (e.g., schema:Recipe, idx:Shard, sync:ManagedDocument). Index entries contain resource-level properties for querying, while sync operations depend on resource type: if resources are documents themselves (e.g., idx:FullIndex), all operations are document-level; if resources use fragment identifiers (e.g., schema:Recipe), sync operations are on the containing document while resource operations are on the specific resource.";
    rdfs:domain [ a owl:Class; owl:unionOf (idx:FullIndex idx:GroupIndexTemplate) ];
    rdfs:range rdfs:Class .

idx:indexedProperty a rdf:Property;
    rdfs:label "indexed property";
    rdfs:comment "Links an index to an IndexedProperty configuration object that specifies which property should be indexed and tracks which installations read from it.";
    rdfs:domain [ a owl:Class; owl:unionOf (idx:FullIndex idx:GroupIndexTemplate) ];
    rdfs:range idx:IndexedProperty .

idx:hasShard a rdf:Property;
    rdfs:label "has shard";
    rdfs:comment "Links an Index to its shard files. This provides the canonical list of active shards.";
    rdfs:domain idx:Index;
    rdfs:range rdfs:Resource .

idx:shardingAlgorithm a rdf:Property;
    rdfs:label "sharding algorithm";
    rdfs:comment "Defines the algorithm used to place new items into shards.";
    rdfs:domain [ a owl:Class; owl:unionOf (idx:Index idx:GroupIndexTemplate) ];
    rdfs:range rdfs:Resource .

idx:hashAlgorithm a rdf:Property;
    rdfs:label "hash algorithm";
    rdfs:comment "The hashing algorithm to be used (e.g., 'md5').";
    rdfs:domain idx:ModuloHashSharding;
    rdfs:range xsd:string .

idx:numberOfShards a rdf:Property;
    rdfs:label "number of shards";
    rdfs:comment "The number of shards to distribute items across.";
    rdfs:domain idx:ModuloHashSharding;
    rdfs:range xsd:integer .

idx:configVersion a rdf:Property;
    rdfs:label "configuration version";
    rdfs:comment "Version string for shard configuration using format 'major_scale_conflict' where major is developer-controlled, scale auto-increments for capacity scaling, and conflict auto-increments for 2P-Set resolution.";
    rdfs:domain idx:ModuloHashSharding;
    rdfs:range xsd:string .

idx:autoScaleThreshold a rdf:Property;
    rdfs:label "auto scale threshold";
    rdfs:comment "The number of entries per shard that triggers automatic scaling to more shards (default: 1000).";
    rdfs:domain idx:ModuloHashSharding;
    rdfs:range xsd:integer .

idx:isShardOf a rdf:Property;
    rdfs:label "is shard of";
    rdfs:comment "A back-link from a shard to the root index or partition it belongs to.";
    rdfs:domain rdfs:Resource;
    rdfs:range idx:Index .

idx:groupedBy a rdf:Property;
    rdfs:label "grouped by";
    rdfs:comment "Links a GroupIndexTemplate to its declarative GroupingRule.";
    rdfs:domain idx:GroupIndexTemplate;
    rdfs:range idx:GroupingRule .

idx:property a rdf:Property;
    rdfs:label "property";
    rdfs:comment "Links a GroupingRule to its GroupingRuleProperty instances. Multi-value property for complex grouping scenarios.";
    rdfs:domain idx:GroupingRule;
    rdfs:range idx:GroupingRuleProperty .

idx:sourceProperty a rdf:Property;
    rdfs:label "source property";
    rdfs:comment "The property in the data resource to extract grouping values from.";
    rdfs:domain idx:GroupingRuleProperty;
    rdfs:range rdf:Property .

idx:transform a rdf:Property;
    rdfs:label "transform";
    rdfs:comment "Ordered list of regex transform rules to apply to the sourceProperty's value for group key generation. Transforms are tried in order, first match wins.";
    rdfs:domain idx:GroupingRuleProperty;
    rdfs:range rdf:List .

idx:hierarchyLevel a rdf:Property;
    rdfs:label "hierarchy level";
    rdfs:comment "Hierarchy level for multi-property grouping. Properties are sorted by level to create nested directory structures. Together with idx:sourceProperty, forms the identification key for GroupingRuleProperty blank nodes. Use 1 when you do not know which value to use.";
    rdfs:domain idx:GroupingRuleProperty;
    rdfs:range xsd:integer .

idx:missingValue a rdf:Property;
    rdfs:label "missing value";
    rdfs:comment "Optional default value to use when the sourceProperty is absent. If not specified, resources without this property create no groups.";
    rdfs:domain idx:GroupingRuleProperty;
    rdfs:range xsd:string .

idx:basedOn a rdf:Property;
    rdfs:label "based on";
    rdfs:comment "A back-link from a GroupIndex to the GroupIndexTemplate rulebook that defines it.";
    rdfs:domain idx:GroupIndex;
    rdfs:range idx:GroupIndexTemplate .

idx:containsEntry a rdf:Property;
    rdfs:label "contains entry";
    rdfs:comment "Links a Shard to a structured entry containing resource reference and metadata." ;
    rdfs:domain idx:Shard ;
    rdfs:range idx:ShardEntry .

idx:readBy a rdf:Property;
    rdfs:label "read by";
    rdfs:comment "An OR-Set of installation IRIs that actively read from this index or specific indexed property. Used for collaborative lifecycle management and property cleanup when readers are tombstoned.";
    rdfs:domain [ a owl:Class; owl:unionOf (idx:Index idx:IndexedProperty) ];
    rdfs:range rdfs:Resource .


idx:populationState a rdf:Property;
    rdfs:label "population state";
    rdfs:comment "State of index population process. Values: 'populating' (initial background processing required), 'active' (ready for normal use). Uses LWW_Register for collaborative state transitions.";
    rdfs:domain idx:Index;
    rdfs:range xsd:string .

idx:hasPopulatingShard a rdf:Property;
    rdfs:label "has populating shard";
    rdfs:comment "References temporary populating shards used during distributed index creation. These shards are tombstoned when population is complete. Uses OR-Set for collaborative shard management.";
    rdfs:domain idx:Index;
    rdfs:range rdfs:Resource .

idx:resource a rdf:Property;
    rdfs:label "resource";
    rdfs:comment "Points to the actual data resource from a shard entry. Links shard entry metadata to the primary resource.";
    rdfs:domain idx:ShardEntry;
    rdfs:range rdfs:Resource .

idx:trackedProperty a rdf:Property;
    rdfs:label "tracked property";
    rdfs:comment "Specifies which RDF property is being tracked in an indexed property configuration object.";
    rdfs:domain idx:IndexedProperty;
    rdfs:range rdf:Property .

idx:pattern a rdf:Property;
    rdfs:label "pattern";
    rdfs:comment "Cross-platform compatible regex pattern for matching RDF literal values. No alternation (|) or named character classes allowed.";
    rdfs:domain idx:RegexTransform;
    rdfs:range xsd:string .

idx:replacement a rdf:Property;
    rdfs:label "replacement";
    rdfs:comment "Replacement template with ${n} backreferences to capture groups. Uses braced syntax for maximum cross-platform compatibility.";
    rdfs:domain idx:RegexTransform;
    rdfs:range xsd:string .
