---
// Modal component for viewing TTL files inline without polluting the namespace
---

<div id="ttl-viewer-modal" class="modal">
  <div class="modal-overlay"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="ttl-viewer-title">Vocabulary</h3>
      <button class="modal-close" aria-label="Close">&times;</button>
    </div>
    <div class="modal-body">
      <pre><code id="ttl-viewer-content" class="language-turtle"></code></pre>
    </div>
    <div class="modal-footer">
      <a id="ttl-viewer-download" class="btn-download" download>â¬‡ Download</a>
      <button class="btn-secondary modal-close">Close</button>
    </div>
  </div>
</div>

<style>
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1000;
    animation: fadeIn 0.2s ease-out;
  }

  .modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(4px);
  }

  .modal-content {
    position: relative;
    background: white;
    border-radius: 12px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    max-width: 90vw;
    max-height: 90vh;
    width: 1200px;
    display: flex;
    flex-direction: column;
    animation: slideUp 0.3s ease-out;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid #e2e8f0;
  }

  .modal-header h3 {
    margin: 0;
    font-size: 1.5rem;
    color: #1e293b;
  }

  .modal-close {
    background: none;
    border: none;
    font-size: 2rem;
    line-height: 1;
    color: #64748b;
    cursor: pointer;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    transition: all 0.2s;
  }

  .modal-close:hover {
    background: #f1f5f9;
    color: #1e293b;
  }

  .modal-body {
    flex: 1;
    overflow: auto;
    padding: 1.5rem;
    background: #f8fafc;
  }

  .modal-body pre {
    margin: 0;
    background: #1e293b;
    border-radius: 8px;
    padding: 1.5rem;
    overflow-x: auto;
  }

  .modal-body code {
    font-family: "Monaco", "Courier New", monospace;
    font-size: 0.875rem;
    line-height: 1.6;
    white-space: pre;
    display: block;
  }

  .modal-footer {
    display: flex;
    gap: 1rem;
    padding: 1.5rem;
    border-top: 1px solid #e2e8f0;
    justify-content: flex-end;
  }

  .btn-download,
  .btn-secondary {
    padding: 0.75rem 1.5rem;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s;
    font-family: inherit;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: 42px;
  }

  .btn-download {
    background: #667eea;
    color: white;
    border: none;
  }

  .btn-download:hover {
    background: #5568d3;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
  }

  .btn-secondary {
    background: #f8fafc;
    color: #475569;
    border: 1px solid #cbd5e1;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .btn-secondary:hover {
    background: #f1f5f9;
    color: #1e293b;
    border-color: #94a3b8;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
  }

  /* Loading state */
  .modal-body.loading {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 200px;
  }

  .modal-body.loading::after {
    content: "Loading...";
    color: #64748b;
    font-size: 1.125rem;
  }
</style>

<script>
  // Use Shiki for proper syntax highlighting (same as CodeBlock component)
  import { codeToHtml } from 'https://esm.sh/shiki@1.0.0';

  // Modal management
  const modal = document.getElementById('ttl-viewer-modal');
  const modalTitle = document.getElementById('ttl-viewer-title');
  const modalContent = document.getElementById('ttl-viewer-content');
  const modalDownload = document.getElementById('ttl-viewer-download') as HTMLAnchorElement;
  const modalBody = modal?.querySelector('.modal-body');
  
  // Close modal function
  function closeModal() {
    modal?.classList.remove('active');
    document.body.style.overflow = '';
  }

  // Close on overlay click or close button
  modal?.querySelectorAll('.modal-close, .modal-overlay').forEach(el => {
    el.addEventListener('click', closeModal);
  });

  // Close on Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modal?.classList.contains('active')) {
      closeModal();
    }
  });

  // Prevent modal content clicks from closing
  modal?.querySelector('.modal-content')?.addEventListener('click', (e) => {
    e.stopPropagation();
  });

  // Open modal function with proper syntax highlighting
  async function openTTLViewer(url: string, title: string) {
    if (!modal || !modalContent || !modalBody || !modalDownload) return;

    // Show modal and loading state
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
    modalTitle!.textContent = title;
    modalBody.classList.add('loading');
    modalContent.innerHTML = '';
    modalDownload.href = url;
    modalDownload.download = url.split('/').pop() || 'vocabulary.ttl';

    try {
      // Fetch TTL content
      const response = await fetch(url);
      if (!response.ok) throw new Error('Failed to load file');
      
      const content = await response.text();
      
      // Use Shiki for syntax highlighting (same as Astro's Code component)
      const html = await codeToHtml(content, {
        lang: 'turtle',
        theme: 'github-dark',
      });
      
      modalContent.innerHTML = html;
      modalBody.classList.remove('loading');
    } catch (error) {
      modalContent.textContent = `Error loading file: ${error}`;
      modalBody.classList.remove('loading');
    }
  }

  // Expose globally for buttons to use
  (window as any).openTTLViewer = openTTLViewer;
</script>
